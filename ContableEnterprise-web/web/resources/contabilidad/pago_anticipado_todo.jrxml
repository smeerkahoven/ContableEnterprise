<?xml version="1.0" encoding="UTF-8"?>
<jasperReport xmlns="http://jasperreports.sourceforge.net/jasperreports" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://jasperreports.sourceforge.net/jasperreports http://jasperreports.sourceforge.net/xsd/jasperreport.xsd" name="null" language="groovy" pageWidth="612" pageHeight="346" columnWidth="596" leftMargin="1" rightMargin="15" topMargin="1" bottomMargin="1" uuid="1b7078e6-ceb5-4087-92f3-21ab3eca1288">
	<property name="ireport.zoom" value="1.7715610000000117"/>
	<property name="ireport.x" value="0"/>
	<property name="ireport.y" value="0"/>
	<parameter name="ID_PAGO" class="java.lang.Integer">
		<defaultValueExpression><![CDATA[]]></defaultValueExpression>
	</parameter>
	<queryString>
		<![CDATA[select distinct
  pa.id_pago_anticipado
  , cc.id_numero_gestion
 , cc.gestion
-- , cc.tipo
, pat.tipo
, pa.factor_cambiario
, pa.id_cliente, upper(cl.nombre) cliente, cl.telefono_fijo
, case pa.moneda when 'B' then 'BOLIVIANOS' when 'U' then 'DOLARES' end moneda
, coalesce(pa.monto_anticipado,0)monto_anticipado
, number_to_string(pa.monto_anticipado) literal
, round(abs(mod(pa.monto_anticipado,1)*100)) decimal_part
, coalesce(pa.monto_total_acreditado,0)monto_total_acreditado
, (pa.monto_anticipado - coalesce(pa.monto_total_acreditado,0)) monto_disponible
, pa.concepto
, case pa.forma_pago 	
		when 'E' then 'CONTADO EFECTIVO' 
		when 'D' then concat('CONTADO con DEPOSITO BANCARIO Nro Deposito:',pa.nro_deposito, ' en la Cuenta: ',coalesce( pc.cuenta,'SIN NOMBRE'))
		when 'H' then concat('CONTADO con CHEQUE Nro:', pa.nro_cheque, ' del Banco:' , coalesce( ba.nombre,' SIN NOMBRE'))
		when  'T' then concat('TARJETA CREDITO/DEBITO con Numero de Tarjeta: ', pa.nro_tarjeta )
	end forma_pago_literal
, pa.id_usuario_creador
, pa.fecha_insert
, case pa.estado when 'A' then 'ANULADO' ELSE 'EMITIDO'  END estado
, date_format(pa.fecha_emision,'%d/%m/%y')fecha_emision_trx
, pat.id_pago_anticipado_transaccion
, pat.descripcion
, pat.estado estado_trx
, coalesce(pat.monto,0) as monto_trx
, date_format(pat.fecha_insert,'%d/%m/%y')fecha_emision
, ndt.id_nota_debito
, de .id_devolucion
 from cnt_pago_anticipado pa 
 inner join cnt_pago_anticipado_transaccion pat on pat.id_pago_anticipado = pa.id_pago_anticipado
 left join cnt_nota_debito_transaccion ndt on ndt.id_nota_debito_transaccion = pat.id_nota_debito_transaccion
 inner join tb_empresa em on em.id_empresa = pa.id_empresa
 inner join cnt_cliente cl on cl.id_cliente = pa.id_cliente
 left join cnt_bancos ba on ba.id_banco = pa.id_banco
 left join cnt_plan_cuentas pc on pc.id_plan_cuentas = pa.id_cuenta_deposito
 left join cnt_tarjetas_credito tc on tc.id_tarjeta_credito = pa.id_tarjeta_credito
 left join cnt_devolucion de on de.id_devolucion = pat.id_devolucion
 left join cnt_comprobante_contable cc on cc.id_pago_anticipado = pa.id_pago_anticipado and cc.tipo in ('CI')
WHERE pa.id_pago_anticipado=$P{ID_PAGO}]]>
	</queryString>
	<field name="id_pago_anticipado" class="java.lang.Integer">
		<fieldDescription><![CDATA[]]></fieldDescription>
	</field>
	<field name="id_numero_gestion" class="java.lang.Integer">
		<fieldDescription><![CDATA[]]></fieldDescription>
	</field>
	<field name="gestion" class="java.lang.Integer">
		<fieldDescription><![CDATA[]]></fieldDescription>
	</field>
	<field name="tipo" class="java.lang.String">
		<fieldDescription><![CDATA[los tipos pueden ser ACREDITACION AC : DEVOLUCION DE]]></fieldDescription>
	</field>
	<field name="factor_cambiario" class="java.math.BigDecimal">
		<fieldDescription><![CDATA[]]></fieldDescription>
	</field>
	<field name="id_cliente" class="java.lang.Integer">
		<fieldDescription><![CDATA[]]></fieldDescription>
	</field>
	<field name="cliente" class="java.lang.String"/>
	<field name="telefono_fijo" class="java.lang.String">
		<fieldDescription><![CDATA[]]></fieldDescription>
	</field>
	<field name="moneda" class="java.lang.String">
		<fieldDescription><![CDATA[]]></fieldDescription>
	</field>
	<field name="monto_anticipado" class="java.math.BigDecimal">
		<fieldDescription><![CDATA[]]></fieldDescription>
	</field>
	<field name="literal" class="java.lang.String"/>
	<field name="decimal_part" class="java.math.BigDecimal"/>
	<field name="monto_total_acreditado" class="java.math.BigDecimal">
		<fieldDescription><![CDATA[]]></fieldDescription>
	</field>
	<field name="monto_disponible" class="java.math.BigDecimal"/>
	<field name="concepto" class="java.lang.String">
		<fieldDescription><![CDATA[]]></fieldDescription>
	</field>
	<field name="forma_pago_literal" class="java.lang.String"/>
	<field name="id_usuario_creador" class="java.lang.String">
		<fieldDescription><![CDATA[]]></fieldDescription>
	</field>
	<field name="fecha_insert" class="java.sql.Timestamp">
		<fieldDescription><![CDATA[]]></fieldDescription>
	</field>
	<field name="estado" class="java.lang.String">
		<fieldDescription><![CDATA[]]></fieldDescription>
	</field>
	<field name="fecha_emision_trx" class="java.lang.String"/>
	<field name="id_pago_anticipado_transaccion" class="java.lang.Integer">
		<fieldDescription><![CDATA[]]></fieldDescription>
	</field>
	<field name="descripcion" class="java.lang.String">
		<fieldDescription><![CDATA[]]></fieldDescription>
	</field>
	<field name="estado_trx" class="java.lang.String"/>
	<field name="monto_trx" class="java.math.BigDecimal"/>
	<field name="fecha_emision" class="java.lang.String">
		<fieldDescription><![CDATA[]]></fieldDescription>
	</field>
	<field name="id_nota_debito" class="java.lang.Integer">
		<fieldDescription><![CDATA[]]></fieldDescription>
	</field>
	<field name="id_devolucion" class="java.lang.Integer">
		<fieldDescription><![CDATA[]]></fieldDescription>
	</field>
	<variable name="TOTAL_TRANS" class="java.math.BigDecimal" calculation="Sum">
		<variableExpression><![CDATA[$F{estado_trx}=="A"?0: $F{monto_trx}]]></variableExpression>
	</variable>
	<background>
		<band splitType="Stretch"/>
	</background>
	<title>
		<band height="16" splitType="Stretch">
			<line>
				<reportElement x="0" y="15" width="570" height="1" uuid="3bc058aa-e879-4659-b64b-16760e44442f"/>
				<graphicElement>
					<pen lineWidth="0.5" lineStyle="Dashed"/>
				</graphicElement>
			</line>
			<textField>
				<reportElement x="266" y="2" width="306" height="12" uuid="ce333745-016b-4ba7-9da3-95d039bf3d32"/>
				<textElement textAlignment="Right">
					<font fontName="Courier 10 Pitch" size="11" isBold="false" isItalic="false" pdfFontName="Courier" isPdfEmbedded="false"/>
				</textElement>
				<textFieldExpression><![CDATA["Pago Anticipado #"+$F{id_pago_anticipado}]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement x="64" y="3" width="192" height="12" uuid="ca94cafc-2689-4783-b095-d2e97d8258be"/>
				<textElement>
					<font fontName="Courier 10 Pitch" size="11" isBold="false" pdfFontName="Courier" isPdfEmbedded="false"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{gestion}+ "-"+ 
    ($F{id_numero_gestion}<10 
    ? "0"+ $F{id_numero_gestion}
    : $F{id_numero_gestion}
)]]></textFieldExpression>
			</textField>
			<staticText>
				<reportElement x="0" y="3" width="63" height="12" uuid="4988aad0-c660-4106-893c-0bef541491bb"/>
				<textElement textAlignment="Right">
					<font fontName="Courier 10 Pitch" size="11" isBold="false" pdfFontName="Courier" isPdfEmbedded="false"/>
				</textElement>
				<text><![CDATA[Asiento:]]></text>
			</staticText>
		</band>
	</title>
	<pageHeader>
		<band splitType="Stretch"/>
	</pageHeader>
	<columnHeader>
		<band height="85" splitType="Stretch">
			<staticText>
				<reportElement x="3" y="1" width="80" height="12" uuid="91211e5a-700a-442e-9e9a-67d3115dfca0"/>
				<textElement textAlignment="Right">
					<font fontName="Courier 10 Pitch" size="11" isBold="false" pdfFontName="Courier" isPdfEmbedded="false"/>
				</textElement>
				<text><![CDATA[Señores:]]></text>
			</staticText>
			<textField>
				<reportElement x="497" y="13" width="75" height="12" uuid="f012d6dc-7a1f-4385-a4df-4e3d93e299a6"/>
				<textElement>
					<font fontName="Courier 10 Pitch" size="11" isBold="false" pdfFontName="Courier" isPdfEmbedded="false"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{fecha_emision}]]></textFieldExpression>
			</textField>
			<staticText>
				<reportElement x="420" y="1" width="77" height="12" uuid="69d122cc-524f-409e-8377-3ab5e99f0540"/>
				<textElement textAlignment="Right">
					<font fontName="Courier 10 Pitch" size="11" isBold="false" pdfFontName="Courier" isPdfEmbedded="false"/>
				</textElement>
				<text><![CDATA[Factor:]]></text>
			</staticText>
			<staticText>
				<reportElement x="379" y="13" width="118" height="12" uuid="d97a1993-c0bc-4d22-9304-bab80c31ac7d"/>
				<textElement textAlignment="Right">
					<font fontName="Courier 10 Pitch" size="11" isBold="false" pdfFontName="Courier" isPdfEmbedded="false"/>
				</textElement>
				<text><![CDATA[Fecha Emision:]]></text>
			</staticText>
			<textField>
				<reportElement x="85" y="1" width="320" height="12" uuid="aa446270-d579-48a9-b474-0968ef915e27"/>
				<textElement>
					<font fontName="Courier 10 Pitch" size="11" isBold="false" pdfFontName="Courier" isPdfEmbedded="false"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{cliente}]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement x="497" y="1" width="75" height="12" uuid="9cf860d9-5b99-4ce4-863b-17ebf7c1b111"/>
				<textElement>
					<font fontName="Courier 10 Pitch" size="11" isBold="false" pdfFontName="Courier" isPdfEmbedded="false"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{factor_cambiario}]]></textFieldExpression>
			</textField>
			<staticText>
				<reportElement x="3" y="13" width="80" height="12" uuid="a3e1565e-59a7-43a2-8b85-0a6f5e2afc8e"/>
				<textElement textAlignment="Right">
					<font fontName="Courier 10 Pitch" size="11" isBold="false" pdfFontName="Courier" isPdfEmbedded="false"/>
				</textElement>
				<text><![CDATA[Estado:]]></text>
			</staticText>
			<textField>
				<reportElement x="85" y="13" width="294" height="12" uuid="cc6dcc58-a6d5-4787-9a6f-8be8093af3d0"/>
				<textElement>
					<font fontName="Courier 10 Pitch" size="11" isBold="false" pdfFontName="Courier" isPdfEmbedded="false"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{estado}]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement x="85" y="37" width="100" height="12" uuid="1c603167-c19e-468d-825e-12f3c5235eb2"/>
				<textElement textAlignment="Left">
					<font fontName="Courier 10 Pitch" size="11" isBold="false" pdfFontName="Courier" isPdfEmbedded="false"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{moneda}]]></textFieldExpression>
			</textField>
			<textField pattern="#,##0.00">
				<reportElement x="122" y="55" width="90" height="12" uuid="3f0064f6-0b23-4b7d-9c5d-f8994da6ce46"/>
				<textElement textAlignment="Right">
					<font fontName="Courier 10 Pitch" size="11" isBold="false" pdfFontName="Courier" isPdfEmbedded="false"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{monto_anticipado}]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement x="85" y="25" width="320" height="12" isPrintWhenDetailOverflows="true" uuid="40928b92-7ec9-46d4-8733-37acad64bf38"/>
				<textElement>
					<font fontName="Courier 10 Pitch" size="11" isBold="false" pdfFontName="Courier" isPdfEmbedded="false"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{concepto}]]></textFieldExpression>
			</textField>
			<staticText>
				<reportElement x="3" y="25" width="80" height="12" uuid="7286db1d-3718-4c78-a50e-df190ae22b5b"/>
				<textElement textAlignment="Right">
					<font fontName="Courier 10 Pitch" size="11" isBold="false" pdfFontName="Courier" isPdfEmbedded="false"/>
				</textElement>
				<text><![CDATA[Descripción:]]></text>
			</staticText>
			<staticText>
				<reportElement x="3" y="37" width="80" height="12" uuid="bc62881b-6f77-4630-b872-bff4daa24b50"/>
				<textElement textAlignment="Right">
					<font fontName="Courier 10 Pitch" size="11" isBold="false" pdfFontName="Courier" isPdfEmbedded="false"/>
				</textElement>
				<text><![CDATA[Moneda:]]></text>
			</staticText>
			<staticText>
				<reportElement x="4" y="55" width="118" height="12" uuid="f91b5eb9-950f-4e7f-9c60-2f01e41c610e"/>
				<textElement textAlignment="Right">
					<font fontName="Courier 10 Pitch" size="11" isBold="false" pdfFontName="Courier" isPdfEmbedded="false"/>
				</textElement>
				<text><![CDATA[Monto Total:]]></text>
			</staticText>
			<staticText>
				<reportElement x="4" y="70" width="59" height="12" uuid="2ab1f506-2d75-47c5-98bd-8501a165dbd2"/>
				<textElement>
					<font fontName="Courier 10 Pitch" size="11" isBold="false" pdfFontName="Courier" isPdfEmbedded="false"/>
				</textElement>
				<text><![CDATA[NRO]]></text>
			</staticText>
			<staticText>
				<reportElement x="136" y="70" width="279" height="12" uuid="37bf0086-f3bb-4adb-92f4-70eb24e56d88"/>
				<textElement>
					<font fontName="Courier 10 Pitch" size="11" isBold="false" pdfFontName="Courier" isPdfEmbedded="false"/>
				</textElement>
				<text><![CDATA[DETALLE]]></text>
			</staticText>
			<staticText>
				<reportElement x="472" y="70" width="100" height="12" uuid="617c9eba-f7d6-4397-9e0c-474d49159e9a"/>
				<textElement textAlignment="Right">
					<font fontName="Courier 10 Pitch" size="11" isBold="false" pdfFontName="Courier" isPdfEmbedded="false"/>
				</textElement>
				<text><![CDATA[MONTO]]></text>
			</staticText>
			<staticText>
				<reportElement x="212" y="55" width="186" height="12" uuid="e584b74f-02e8-4ae8-b3df-5324945d5e6a"/>
				<textElement textAlignment="Right">
					<font fontName="Courier 10 Pitch" size="11" isBold="false" pdfFontName="Courier" isPdfEmbedded="false"/>
				</textElement>
				<text><![CDATA[Monto Total Disponible:]]></text>
			</staticText>
			<staticText>
				<reportElement x="64" y="70" width="71" height="12" uuid="8d0f667d-e243-476d-8f3e-4d07d20fb9c8"/>
				<textElement>
					<font fontName="Courier 10 Pitch" size="11" isBold="false" pdfFontName="Courier" isPdfEmbedded="false"/>
				</textElement>
				<text><![CDATA[FECHA]]></text>
			</staticText>
			<line>
				<reportElement x="4" y="84" width="568" height="1" uuid="a61d4348-3301-4a82-8097-03982e5cc9ee"/>
				<graphicElement>
					<pen lineWidth="0.5" lineStyle="Dashed"/>
				</graphicElement>
			</line>
			<textField pattern="#,##0.00">
				<reportElement x="398" y="55" width="90" height="12" uuid="6a2d6781-6184-4f4f-9d08-427b42126398"/>
				<textElement textAlignment="Right">
					<font fontName="Courier 10 Pitch" size="11" isBold="false" pdfFontName="Courier" isPdfEmbedded="false"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{monto_disponible}]]></textFieldExpression>
			</textField>
		</band>
	</columnHeader>
	<detail>
		<band height="12" splitType="Stretch">
			<textField>
				<reportElement x="4" y="0" width="59" height="12" uuid="320f7b2d-c09d-4eb3-94c8-c6413ee76dbd"/>
				<textElement textAlignment="Left">
					<font fontName="Courier 10 Pitch" size="11" isBold="false" pdfFontName="Courier" isPdfEmbedded="false"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{id_pago_anticipado_transaccion}]]></textFieldExpression>
			</textField>
			<textField isStretchWithOverflow="true">
				<reportElement x="136" y="0" width="336" height="12" isPrintWhenDetailOverflows="true" uuid="e21c8439-99da-44dc-af8f-77175da24e9e"/>
				<textElement textAlignment="Left">
					<font fontName="Courier 10 Pitch" size="11" isBold="false" pdfFontName="Courier" isPdfEmbedded="false"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{descripcion} + 
( $F{id_nota_debito}!= null? " - ND : " + $F{id_nota_debito} : " - DE : " +$F{id_devolucion} ) 
+" " + ($F{estado_trx} == "A" ? "ANULADO" : "")]]></textFieldExpression>
			</textField>
			<textField pattern="#,##0.00">
				<reportElement x="472" y="0" width="100" height="12" uuid="d47da4a6-c01d-47ef-b17c-b18bdb48457c"/>
				<textElement textAlignment="Right">
					<font fontName="Courier 10 Pitch" size="11" isBold="false" pdfFontName="Courier" isPdfEmbedded="false"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{monto_trx}]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement x="63" y="0" width="73" height="12" uuid="d89cfed8-8162-485c-ad22-f2009397db4f"/>
				<textElement textAlignment="Left">
					<font fontName="Courier 10 Pitch" size="11" isBold="false" pdfFontName="Courier" isPdfEmbedded="false"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{fecha_emision_trx}]]></textFieldExpression>
			</textField>
		</band>
	</detail>
	<columnFooter>
		<band splitType="Stretch"/>
	</columnFooter>
	<pageFooter>
		<band splitType="Stretch"/>
	</pageFooter>
	<summary>
		<band height="119" splitType="Immediate">
			<staticText>
				<reportElement x="4" y="3" width="423" height="12" uuid="ec5e034f-fe5a-4596-b3b5-fba92a343bae"/>
				<textElement>
					<font fontName="Courier 10 Pitch" size="11" isBold="false" pdfFontName="Courier" isPdfEmbedded="false"/>
				</textElement>
				<text><![CDATA[TOTAL]]></text>
			</staticText>
			<textField isStretchWithOverflow="true">
				<reportElement x="4" y="15" width="568" height="12" isPrintWhenDetailOverflows="true" uuid="c55180f6-32b4-4297-a54b-b869ccfd2192"/>
				<textElement>
					<font fontName="Courier 10 Pitch" size="11" isBold="false" pdfFontName="Courier" isPdfEmbedded="false"/>
				</textElement>
				<textFieldExpression><![CDATA["Pago:" + $F{forma_pago_literal}]]></textFieldExpression>
			</textField>
			<line>
				<reportElement x="4" y="0" width="567" height="1" uuid="aa9fb224-9a40-496d-bf69-8d1655ffa819"/>
				<graphicElement>
					<pen lineWidth="0.5" lineStyle="Dashed"/>
				</graphicElement>
			</line>
			<staticText>
				<reportElement x="324" y="74" width="200" height="12" uuid="2da1d7a4-23ba-46c0-b77c-c97acfc64208"/>
				<textElement textAlignment="Center">
					<font fontName="Courier 10 Pitch" size="11" isBold="false" pdfFontName="Courier" isPdfEmbedded="false"/>
				</textElement>
				<text><![CDATA[FIRMA DEL CLIENTE]]></text>
			</staticText>
			<textField>
				<reportElement x="54" y="74" width="200" height="12" uuid="72313c7b-c225-410f-8ea8-17bcadb4c591"/>
				<textElement textAlignment="Center">
					<font fontName="Courier 10 Pitch" size="11" isBold="false" pdfFontName="Courier" isPdfEmbedded="false"/>
				</textElement>
				<textFieldExpression><![CDATA["AUTORIZADO POR :" + $F{id_usuario_creador}]]></textFieldExpression>
			</textField>
			<line>
				<reportElement x="54" y="73" width="200" height="1" uuid="7daf2de4-3486-45f7-a7d3-d02d42e569d1"/>
				<graphicElement>
					<pen lineWidth="0.5" lineStyle="Dashed"/>
				</graphicElement>
			</line>
			<line>
				<reportElement x="324" y="73" width="200" height="1" uuid="3d325509-9800-4fef-9da6-9376c61ff5d8"/>
				<graphicElement>
					<pen lineWidth="0.5" lineStyle="Dashed"/>
				</graphicElement>
			</line>
			<textField>
				<reportElement x="1" y="97" width="496" height="12" uuid="1a165738-5c3d-404d-8dbb-dd241f33b51e"/>
				<textElement>
					<font fontName="Courier 10 Pitch" size="11" isBold="false" pdfFontName="Courier" isPdfEmbedded="false"/>
				</textElement>
				<textFieldExpression><![CDATA["Creado por: " + $F{id_usuario_creador} + " fecha: " + $F{fecha_insert}]]></textFieldExpression>
			</textField>
			<textField pattern="#,##0.00">
				<reportElement x="472" y="3" width="100" height="12" uuid="619a3b2a-1db7-4d6a-8e19-e4b9a2800e00"/>
				<textElement textAlignment="Right">
					<font fontName="Courier 10 Pitch" size="11" isBold="false" pdfFontName="Courier" isPdfEmbedded="false"/>
				</textElement>
				<textFieldExpression><![CDATA[$V{TOTAL_TRANS}]]></textFieldExpression>
			</textField>
		</band>
	</summary>
</jasperReport>
